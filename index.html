<title>Mt. Moon</title>
<style>
body {display: flex; justify-content: center}
#screen {
	width: 50%;
	height 50%;
	image-rendering: pixelated;
	border: 12px solid #253238;
	border-radius: 6px;
}
</style>
<script type=module>
const f1 = [
	[5,4,4,3,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3],
	[6,1,1,2,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2],
	[6,1,1,2,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2],
	[6,1,1,2,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9],
	[6,1,1,2,35,35,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,3],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,35,35,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,35,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,16,15,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,17,18,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,1,35,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,34,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,5,4,4,4,4,4,4,3,5,4,4,4,4,4,4,3,5,4,4,4,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,1,1,1,1,2,6,1,1,1,1,1,1,2,6,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,1,1,1,1,2,6,1,1,1,1,1,1,2,6,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,7,8,8,8,8,8,8,9,7,8,8,8,8,8,8,9,7,8,8,8,8,8,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,5,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,16,15,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,17,18,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,3,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,5,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,16,15,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,17,18,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,35,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,5,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,3,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,9,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,5,4,4,4,4,4,4,4,4,4,4,3,5,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,3,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,6,1,1,1,1,1,1,1,1,1,1,2,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,6,1,1,1,1,1,1,1,1,1,1,2,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,7,8,8,8,8,8,8,8,8,8,8,9,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,35,1,0,0,0,0,0,0,0,0,0,0,6,1,1,2,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,6,1,1,2,0,0,0,0,5,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,3,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,6,1,1,2,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,6,1,1,2,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,7,8,8,9,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,35,35,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,35,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,30,29,0,35,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,35,1,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,0,0,31,32,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,3,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,4,4,3,0,5,4,4,4,4,4,4,3,0,0,0,0,0,5,4,4,4,4,3,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,6,1,1,1,1,2,3,6,1,1,1,1,1,1,2,0,0,0,0,5,6,1,1,1,1,2,3,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,6,1,1,1,1,1,1,2,0,0,0,0,6,6,1,1,1,1,2,2,35,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,7,8,8,8,8,8,8,9,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,4,4,3,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,6,1,1,1,1,2,3,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,6,7,8,8,8,8,9,2,0,0,0,0,0,0,0,0,0,0,35,1,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,8,8,8,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,35,1,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,6,6,1,1,1,1,2,2,35,35,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
	[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,9],
	[6,1,1,2,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,6,6,1,1,1,1,2,2,0,0,0,0,6,6,1,1,1,1,2,2,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3],
	[6,1,1,2,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,6,6,1,1,1,1,2,2,0,0,0,0,6,6,1,1,1,1,2,2,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2],
	[6,1,1,2,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,6,7,8,8,8,8,9,2,33,33,33,33,6,7,8,8,8,8,9,2,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2],
	[7,8,8,9,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,7,8,8,8,8,8,8,9,33,33,33,33,7,8,8,8,8,8,8,9,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9],
]

const screen_width = 20
const screen_height = 18

function gen_transition_maps(map) {
	const width = map[0].length;
	const height = map.length;

	const t_e = new Map()
	for (let r = 0; r < height - screen_height; r += 2) {
		for (let c = 1; c < width - 2; c += 2) {
			const from = new Array(screen_height)
			const to = [new Array(screen_height), new Array(screen_height)]
			for (let i = 0; i < screen_height; ++i) {
				from[i] = map[r + i][c];
				to[0][i] = map[r + i][c + 1];
				to[1][i] = map[r + i][c + 2];
			}
			const from_s = from.join()
			if (!t_e.has(from_s)) t_e.set(from_s, [])
			t_e.get(from_s).push(to)
		}
	}

	const t_n = new Map()
	for (let r = 2; r < height; r += 2) {
		for (let c = 0; c < width - screen_width; c += 2) {
			const from = new Array(screen_width)
			const to = [new Array(screen_width), new Array(screen_width)]
			for (let i = 0; i < screen_width; ++i) {
				from[i] = map[r][c + i];
				to[0][i] = map[r - 1][c + i];
				to[1][i] = map[r - 2][c + i];
			}
			const from_s = from.join()
			if (!t_n.has(from_s)) t_n.set(from_s, [])
			t_n.get(from_s).push(to)
		}
	}

	const t_w = new Map()
	for (let r = 0; r < height - screen_height; r += 2) {
		for (let c = 2; c < width; c += 2) {
			const from = new Array(screen_height)
			const to = [new Array(screen_height), new Array(screen_height)]
			for (let i = 0; i < screen_height; ++i) {
				from[i] = map[r + i][c];
				to[0][i] = map[r + i][c - 1];
				to[1][i] = map[r + i][c - 2];
			}
			const from_s = from.join()
			if (!t_w.has(from_s)) t_w.set(from_s, [])
			t_w.get(from_s).push(to)
		}
	}

	const t_s = new Map()
	for (let r = 0; r < height - 2; r += 2) {
		for (let c = 0; c < width - screen_width; c += 2) {
			const from = new Array(screen_width)
			const to = [new Array(screen_width), new Array(screen_width)]
			for (let i = 0; i < screen_width; ++i) {
				from[i] = map[r][c + i];
				to[0][i] = map[r + 1][c + i];
				to[1][i] = map[r + 2][c + i];
			}
			const from_s = from.join()
			if (!t_s.has(from_s)) t_s.set(from_s, [])
			t_s.get(from_s).push(to)
		}
	}

	return {e: t_e, n: t_n, w: t_w, s: t_s}
}

function append_view(view, dir, transitions) {
	const from =
		dir === 'e' ? view.map(row => row[row.length - 1]) :
		dir === 'n' ? view[0].join() :
		dir === 's' ? view[view.length - 1].join() :
		dir === 'w' ? view.map(row => row[0]) :
		undefined
	const choices = transitions[dir].get(from)
		?? [[new Array(from.length).fill(0), new Array(from.length).fill(0)]]
	const i = Math.floor(Math.random() * choices.length)
	const choice = window.structuredClone(choices[i])

	switch (dir) {
		case 'e':
			for (let i = 0; i < view.length; ++i) {
				view[i].push(choice[0][i])
				view[i].push(choice[1][i])
			}
			break
		case 'n':
			view.unshift(choice[0])
			view.unshift(choice[1])
			break
		case 'w':
			for (let i = 0; i < view.length; ++i) {
				view[i].unshift(choice[0][i])
				view[i].unshift(choice[1][i])
			}
			break
		case 's':
			view.push(choice[0])
			view.push(choice[1])
			break
	}
}

function truncate_view(view, dir) {
	switch (dir) {
		case 'e':
			for (let i = 0; i < view.length; ++i) {
				view[i].shift()
				view[i].shift()
			}
			break
		case 'n':
			view.pop()
			view.pop()
			break
		case 'w':
			for (let i = 0; i < view.length; ++i) {
				view[i].pop()
				view[i].pop()
			}
			break
		case 's':
			view.shift()
			view.shift()
			break
	}
}

const f1_transitions = gen_transition_maps(f1)

const init_offset = {x: 10, y: 31}
const view = []
for (let r = 0; r < 18; ++r) {
	view.push([])
	for (let c = 0; c < 20; ++c) {
		view[r].push(f1[r + init_offset.y * 2]?.at(c + init_offset.x * 2) ?? 34)
	}
}

const tile_size = 8
const screen = document.getElementById('screen')
const ctx = screen.getContext('2d')
const tiles_image = await fetch('assets/tiles.png')
	.then(res => res.blob())
	.then(blob => window.createImageBitmap(blob))

function get_offset(i) {
	const width = tiles_image.width / tile_size
	const row = Math.floor(i / width)
	const col = i % width
	return [col * tile_size, row * tile_size]
}

function draw_tile(i, r, c) {
	const [tx, ty] = get_offset(i)
	const [x, y] = [c * tile_size, r * tile_size]
}

function draw_view(view, offx, offy) {
	for (let r = 0; r < view.length; ++r) {
		for (let c = 0; c < view[r].length; ++c) {
			const [tx, ty] = get_offset(view[r][c])
			const [x, y] = [c * tile_size + offx, r * tile_size + offy]
			ctx.drawImage(tiles_image, tx, ty, tile_size, tile_size, x, y, tile_size, tile_size)
		}
	}
}

function draw_player() {
	ctx.fillStyle = 'rgba(0, 0, 0, 0.75)'
	ctx.beginPath()
	ctx.arc(16 * 4.5, 16 * 4.5, 7, 0, 2 * Math.PI)
	ctx.fill()
}

const state = {
	view: view,
	move_dir: null,
	moving: false,
	move_pos: 0,
}

document.body.addEventListener('keydown', e => {
	if (state.moving) return;
	switch (e.key) {
		case 'ArrowRight':
			state.move_dir = 'e'
			break
		case 'ArrowUp':
			state.move_dir = 'n'
			break
		case 'ArrowLeft':
			state.move_dir = 'w'
			break
		case 'ArrowDown':
			state.move_dir = 's'
			break
	}
})

function run() {
	if (state.move_dir !== null) {
		append_view(state.view, state.move_dir, f1_transitions)
		truncate_view(state.view, state.move_dir)
		state.move_dir = null
	}
	draw_view(state.view, 0, 0)
	draw_player()
	requestAnimationFrame(run)
}

requestAnimationFrame(run)

</script>
<canvas id=screen width=160 height=144></canvas>
