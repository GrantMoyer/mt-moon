<!DOCTYPE html>
<title>Mt. Moon</title>
<!--
	This file released under CC0.

	Image assets are copyright by The Pokemon Company, and I believe their use here falls
	under fair use.
-->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" type="image/png" href="assets/favicon.png">
<style>
:root {
	--border-width: 18px;
	--background-color: #1b1d26;
	--border-color: #253238;
	--shadow-color: #15171f;
	--corner-color: #45a8f6;
	--corner-ratio: 0.2;
	--scale: 1;
}
body {display: flex; justify-content: center; align-items: center; background: var(--background-color); width: 100dvw; height: 100dvh; margin: 0px}
#screen {
	width: calc(160px * var(--scale));
	height: calc(144px * var(--scale));
	image-rendering: pixelated;
	border: var(--border-width) solid transparent;
	border-radius: calc(var(--border-width) * (3 / 5));
	box-shadow: 0 var(--border-width) calc(var(--border-width) * 2) var(--shadow-color);
	--corner-size: calc(var(--border-width) * 0.8);
	--corner-offset-a: calc(var(--border-width) * (0.5 + var(--corner-ratio) / 2));
	--corner-offset-b: calc(var(--border-width) * (0.5 - var(--corner-ratio) / 2));
	--corner-offset-aa: calc(var(--corner-size) - var(--corner-offset-a) - 0.5px);
	--corner-offset-ab: calc(var(--corner-size) - var(--corner-offset-a) + 0.5px);
	--corner-offset-ba: calc(var(--corner-size) - var(--corner-offset-b) - 0.5px);
	--corner-offset-bb: calc(var(--corner-size) - var(--corner-offset-b) + 0.5px);
	--corner-width: calc(var(--border-width) * var(--corner-ratio));
	--corner-len: calc(var(--border-width) * 2 - var(--corner-size));
	background:
		radial-gradient(
			at bottom right,
			transparent var(--corner-offset-aa),
			var(--corner-color) var(--corner-offset-ab),
			var(--corner-color) var(--corner-offset-ba),
			transparent var(--corner-offset-bb)
		) border-box top left / var(--corner-size) var(--corner-size) no-repeat,
		linear-gradient(var(--corner-color)) border-box top var(--corner-size) left var(--corner-offset-b)
			/ var(--corner-width) var(--corner-len) no-repeat,
		linear-gradient(var(--corner-color)) border-box top var(--corner-offset-b) left var(--corner-size)
			/ var(--corner-len) var(--corner-width) no-repeat,
		radial-gradient(
			at bottom left,
			transparent var(--corner-offset-aa),
			var(--corner-color) var(--corner-offset-ab),
			var(--corner-color) var(--corner-offset-ba),
			transparent var(--corner-offset-bb)
		) border-box top right / var(--corner-size) var(--corner-size) no-repeat,
		linear-gradient(var(--corner-color)) border-box top var(--corner-size) right var(--corner-offset-b)
			/ var(--corner-width) var(--corner-len) no-repeat,
		linear-gradient(var(--corner-color)) border-box top var(--corner-offset-b) right var(--corner-size)
			/ var(--corner-len) var(--corner-width) no-repeat,
		radial-gradient(
			at top right,
			transparent var(--corner-offset-aa),
			var(--corner-color) var(--corner-offset-ab),
			var(--corner-color) var(--corner-offset-ba),
			transparent var(--corner-offset-bb)
		) border-box bottom left / var(--corner-size) var(--corner-size) no-repeat,
		linear-gradient(var(--corner-color)) border-box bottom var(--corner-size) left var(--corner-offset-b)
			/ var(--corner-width) var(--corner-len) no-repeat,
		linear-gradient(var(--corner-color)) border-box bottom var(--corner-offset-b) left var(--corner-size)
			/ var(--corner-len) var(--corner-width) no-repeat,
		radial-gradient(
			at top left,
			transparent var(--corner-offset-aa),
			var(--corner-color) var(--corner-offset-ab),
			var(--corner-color) var(--corner-offset-ba),
			transparent var(--corner-offset-bb)
		) border-box bottom right / var(--corner-size) var(--corner-size) no-repeat,
		linear-gradient(var(--corner-color)) border-box bottom var(--corner-size) right var(--corner-offset-b)
			/ var(--corner-width) var(--corner-len) no-repeat,
		linear-gradient(var(--corner-color)) border-box bottom var(--corner-offset-b) right var(--corner-size)
			/ var(--corner-len) var(--corner-width) no-repeat,
		var(--border-color);
}
</style>
<script type=module>
const screen_width = 20
const screen_height = 18

const maps = {
	f1: [
		[5,4,4,3,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3],
		[6,1,1,2,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2],
		[6,1,1,2,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2],
		[6,1,1,2,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,3],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,16,15,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,17,18,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,5,4,4,4,4,4,4,3,5,4,4,4,4,4,4,3,5,4,4,4,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,1,1,1,1,2,6,1,1,1,1,1,1,2,6,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,1,1,1,1,2,6,1,1,1,1,1,1,2,6,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,7,8,8,8,8,8,8,9,7,8,8,8,8,8,8,9,7,8,8,8,8,8,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,5,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,16,15,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,17,18,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,3,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,5,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,16,15,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,17,18,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,5,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,3,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,9,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,5,4,4,4,4,4,4,4,4,4,4,3,5,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,3,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,6,1,1,1,1,1,1,1,1,1,1,2,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,6,1,1,1,1,1,1,1,1,1,1,2,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,7,8,8,8,8,8,8,8,8,8,8,9,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,6,1,1,2,0,0,0,0,5,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,3,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,6,1,1,2,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,6,1,1,2,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,7,8,8,9,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,30,29,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,0,0,31,32,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,3,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,4,4,3,0,5,4,4,4,4,4,4,3,0,0,0,0,0,5,4,4,4,4,3,0,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,6,1,1,1,1,2,3,6,1,1,1,1,1,1,2,0,0,0,0,5,6,1,1,1,1,2,3,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,6,1,1,1,1,1,1,2,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,6,1,1,2,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,7,8,8,8,8,8,8,9,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,4,4,4,3,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,6,1,1,1,1,2,3,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,6,7,8,8,8,8,9,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,8,8,8,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,1,1,2],
		[6,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,6,6,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,9],
		[6,1,1,2,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,6,6,1,1,1,1,2,2,0,0,0,0,6,6,1,1,1,1,2,2,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3],
		[6,1,1,2,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,6,6,1,1,1,1,2,2,0,0,0,0,6,6,1,1,1,1,2,2,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2],
		[6,1,1,2,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,6,7,8,8,8,8,9,2,33,33,33,33,6,7,8,8,8,8,9,2,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2],
		[7,8,8,9,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,7,8,8,8,8,8,8,9,33,33,33,33,7,8,8,8,8,8,8,9,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9],
	],
	b1: [
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,8,8,8,8,8,8,8,8,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,16,15,1,1,1,1,1,1,20,19],
		[34,34,34,34,34,34,34,34,8,8,8,8,8,8,8,8,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,17,18,1,1,1,1,1,1,21,22],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34],
		[34,34,34,34,34,34,34,34,1,1,20,19,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34],
		[34,34,34,34,34,34,34,34,1,1,21,22,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,34,34,34,34],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,34,34,34,34],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,34,34,34,34],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,34,34,34,34],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,20,19,34,34,34,34],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,21,22,34,34,34,34],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,34,34,34,34],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,34,34,34,34],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,16,15,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,34,34,34,34],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,17,18,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,34,34,34,34],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,8,8,8,8,8,8,8,8],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,8,8,8,8,8,8,8,8],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,34,34,34,34,1,1,20,19,1,1,1,1],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,34,34,34,34,1,1,21,22,1,1,1,1],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,34,34,34,34,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,34,34,34,34,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,16,15,34,34,34,34,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,17,18,34,34,34,34,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,16,15,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
		[34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,1,1,17,18,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
	],
	b2: [
		[8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,1,1,1,1,1,1,1,1],
		[8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,1,1,1,1,1,1,1,1],
		[8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,1,1,1,1,1,1,1,1],
		[8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,1,1,1,1,1,1,1,1],
		[12,11,12,11,0,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,0,12,11,12,11,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,1,1,1,1,1,1,1,1],
		[13,14,13,14,5,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,13,14,13,14,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,1,1,1,1,1,1,1,1],
		[12,11,12,11,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,12,11,12,11,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,1,1,1,1,1,1,1,1],
		[13,14,13,14,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,13,14,13,14,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,1,1,1,1,1,1,1,1],
		[12,11,12,11,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,12,11,12,11,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,1,1,1,1,1,1,1,1],
		[13,14,13,14,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,13,14,13,14,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,1,1,1,1,1,1,1,1],
		[12,11,12,11,6,7,24,23,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,10,1,1,1,1,35,8,8,8,8,8,9,2,12,11,12,11,1,1,1,1,1,1,35,8,8,8,8,8,8,10,1,1,1,1,1,1,1,1,35,8,8,8,8,8,8,8,8,8,1,1,1,1,1,1,1,1],
		[13,14,13,14,7,8,24,23,8,8,8,8,8,8,8,8,8,8,8,8,8,8,10,6,1,1,1,1,2,35,8,8,8,8,8,9,13,14,13,14,1,1,1,1,1,1,2,35,8,8,8,8,10,6,1,1,1,1,1,1,1,1,2,35,8,8,8,8,8,8,8,8,1,1,1,1,1,1,1,1],
		[12,11,12,11,1,1,1,1,1,1,1,1,1,1,1,1,0,5,4,4,4,4,4,4,1,1,1,1,4,4,4,4,4,4,3,0,12,11,12,11,1,1,1,1,1,1,2,2,0,0,0,0,6,6,1,1,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1],
		[13,14,13,14,1,1,1,1,1,1,1,1,1,1,1,1,5,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,13,14,13,14,1,1,1,1,1,1,2,2,0,0,0,0,6,6,1,1,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1],
		[12,11,12,11,1,1,1,1,1,1,20,19,1,1,1,1,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,12,11,12,11,1,1,1,1,1,1,2,2,0,0,0,0,6,7,8,8,24,23,24,23,8,8,9,2,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1],
		[13,14,13,14,1,1,1,1,1,1,21,22,1,1,1,1,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,13,14,13,14,1,1,1,1,1,1,2,2,0,0,0,0,7,8,8,8,24,23,24,23,8,8,8,9,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1],
		[12,11,12,11,1,1,1,1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,12,11,12,11,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8],
		[13,14,13,14,1,1,1,1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,13,14,13,14,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8],
		[12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,6,7,8,8,8,8,8,8,24,23,24,23,8,10,1,1,1,1,2,2,12,11,12,11,1,1,1,1,1,1,2,2,0,0,20,19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,26,25,0,0,0,0,8,8,8,8,8,8,8,8],
		[13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,7,8,8,8,8,8,8,8,24,23,24,23,10,6,1,1,1,1,2,2,13,14,13,14,1,1,1,1,1,1,2,2,0,0,21,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,27,28,0,0,0,0,8,8,8,8,8,8,8,8],
		[8,8,8,8,8,8,8,8,8,8,8,8,12,11,12,11,1,1,1,1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,2,2,12,11,12,11,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8],
		[8,8,8,8,8,8,8,8,8,8,8,8,13,14,13,14,1,1,1,1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,2,2,13,14,13,14,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8],
		[8,8,8,8,8,8,8,8,8,8,8,8,12,11,12,11,1,1,1,1,1,1,1,1,1,1,1,1,6,7,8,8,8,8,9,2,12,11,12,11,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8],
		[8,8,8,8,8,8,8,8,8,8,8,8,13,14,13,14,1,1,1,1,1,1,1,1,1,1,1,1,7,8,8,8,8,8,8,9,13,14,13,14,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8],
		[0,0,0,0,0,0,0,0,0,0,0,0,12,11,12,11,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,12,11,12,11,1,1,1,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,3,0,0,5,4,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,35,8],
		[0,0,0,0,0,0,0,0,0,0,0,0,13,14,13,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,13,14,13,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,5,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,35],
		[0,0,0,0,0,0,0,0,0,0,0,0,12,11,12,11,12,11,12,11,12,11,12,11,1,1,1,1,12,11,12,11,12,11,12,11,12,11,12,11,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,13,14,13,14,13,14,13,14,13,14,13,14,1,1,1,1,13,14,13,14,13,14,13,14,13,14,13,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,8,1,1,1,1,8,8,8,8,8,8,8,8,12,11,12,11,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,8,1,1,1,1,8,8,8,8,8,8,8,8,13,14,13,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,8,1,1,1,1,8,8,8,8,8,8,8,8,12,11,12,11,1,1,1,1,1,1,1,1,35,8,8,8,24,23,24,23,8,8,9,2,6,7,8,8,24,23,24,23,8,8,8,10,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,8,1,1,1,1,8,8,8,8,8,8,8,8,13,14,13,14,1,1,1,1,1,1,1,1,2,35,8,8,24,23,24,23,8,8,8,9,7,8,8,8,24,23,24,23,8,8,10,6,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,12,11,12,11,1,1,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,13,14,13,14,1,1,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,12,11,12,11,1,1,20,19,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,13,14,13,14,1,1,21,22,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,12,11,12,11,1,1,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,13,14,13,14,1,1,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,12,11,12,11,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,12,11,12,11,8,8,8,8,8,8,8,8,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,13,14,13,14,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,13,14,13,14,8,8,8,8,8,8,8,8,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,12,11,12,11,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,10,1,1,1,1,1,1,1,1,35,8,8,8,8,8,12,11,12,11,8,8,8,8,8,8,8,8,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,13,14,13,14,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,10,6,1,1,1,1,1,1,1,1,2,35,8,8,8,8,13,14,13,14,8,8,8,8,8,8,8,8,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,12,11,12,11,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,1,1,1,1,2,2,1,1,1,1,12,11,12,11,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,13,14,13,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,1,1,1,1,2,2,1,1,1,1,13,14,13,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,12,11,12,11,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,7,8,8,24,23,24,23,8,8,9,2,1,1,1,1,12,11,12,11,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,13,14,13,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,7,8,8,8,24,23,24,23,8,8,8,9,1,1,1,1,13,14,13,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,12,11,12,11,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,12,11,12,11,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,13,14,13,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,13,14,13,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,12,11,12,11,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,12,11,12,11,1,1,1,1,1,1,35,8,8,8,8,8,8,8,9,2],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,13,14,13,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,13,14,13,14,1,1,1,1,1,1,2,35,8,8,8,8,8,8,8,9],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,12,11,12,11,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,12,11,12,11,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,13,14,13,14,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,13,14,13,14,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,12,11,12,11,1,1,20,19,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,12,11,12,11,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,13,14,13,14,1,1,21,22,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,13,14,13,14,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,12,11,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,13,14,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,6,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,2,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
	]
}

const ladders = {
	f1: {
		up: [],
		down: [{x: 5, y: 5}, {x: 17, y: 11}, {x: 25, y: 15}],
	},
	b1: {
		up: [{x: 5, y: 5}, {x: 27, y: 3}, {x: 25, y: 9}, {x: 25, y: 15}],
		down: [{x: 23, y: 3}, {x: 17, y: 11}, {x: 21, y: 17}, {x: 13, y: 27}],
	},
	b2: {
		up: [{x: 5, y: 7}, {x: 25, y: 9}, {x: 21, y: 17}, {x: 15, y: 27}],
		down: [],
	},
}

const characters = [
	"A",  "B",  "C", "D",  "E",  "F", "G", "H", "I",  "J",  "K",  "L",  "M",  "N",  "O",  "P",
	"Q",  "R",  "S", "T",  "U",  "V", "W", "X", "Y",  "Z",  "(",  ")",  ":",  ";",  "[",  "]",
	"a",  "b",  "c", "d",  "e",  "f", "g", "h", "i",  "j",  "k",  "l",  "m",  "n",  "o",  "p",
	"q",  "r",  "s", "t",  "u",  "v", "w", "x", "y",  "z",  "é", "'d", "'l", "'s", "'t", "'v",
	"'", "ᴾₖ", "ᴹₙ", "-", "'r", "'m", "?", "!", ".", "ァ", "ゥ", "ェ",  "▷",  "▶",  "▼",  "♂",
	"$",  "×",  "·", "/",  ",",  "♀", "0", "1", "2",  "3",  "4",  "5",  "6",  "7",  "8",  "9",
	"␄",  "╗",  "╔", "╚",  "╝",  "║", "═", " ",
]
const char_indices = new Map(characters.entries().map(([i, c]) => [c, i]))

function encode_text(text) {
	const buffer = new ArrayBuffer(text.length)
	const encoded = new Uint8Array(buffer)
	let processed = 0
	let chars_written = 0
	while (processed < text.length) {
		const i = char_indices.get(text.substring(processed, processed + 2))
			?? char_indices.get(text[processed])
		if (i !== undefined) encoded[chars_written++] = i
		processed += i === undefined ? 1 : characters[i].length
	}
	const finialized_buffer = buffer.transferToFixedLength(chars_written)
	return new Uint8Array(finialized_buffer)
}

function concat_encoded_text(...texts) {
	const length = texts.reduce((acc, text) => acc + text.length, 0)
	const concat = new Uint8Array(length)
	let offset = 0
	for (let text of texts) {
		concat.set(text, offset)
		offset += text.length
	}
	return concat
}

const npc_locations = {
	f1: [
		{x: 5, y: 6, dir: 's', name: 'hiker', sprite: 0},
		{x: 7, y: 22, dir: 's', name: 'bug_catcher_w', sprite: 1},
		{x: 12, y: 16, dir: 'e', name: 'youngster', sprite: 1},
		{x: 16, y: 23, dir: 's', name: 'lass_s', sprite: 2},
		{x: 24, y: 31, dir: 'n', name: 'super_nerd', sprite: 3},
		{x: 30, y: 4, dir: 's', name: 'lass_n', sprite: 4},
		{x: 30, y: 27, dir: 'e', name: 'bug_catcher_e', sprite: 5},
	],
	b1: [],
	b2: [
		{x: 11, y: 16, dir: 's', name: 'grunt_w', sprite: 6},
		{x: 12, y: 8, dir: 'e', name: 'fossil_nerd', sprite: 7},
		{x: 15, y: 22, dir: 's', name: 'grunt_s', sprite: 6},
		{x: 29, y: 11, dir: 'n', name: 'grunt_n', sprite: 6},
		{x: 29, y: 17, dir: 'w', name: 'grunt_e', sprite: 6},
	],
}

const npc_dialogs = flow_dialog_tree(screen_width - 3, {
	bug_catcher_e: [
		["ZUBAT is tough! But, it can be useful if you catch one."],
		["I've never actually seen a ZUBAT though.", "Have you?", {
			YES: ["Are you sure?"],
			NO: ["I wonder if they're even real."],
		}],
	],
	bug_catcher_w: [
		["I saw them! I'm sure they're from TEAM ROCKET!"],
		["Is TEAM ROCKET evil?"],
	],
	fossil_nerd: [
		[
			"Far away, on CINNABAR ISLAND, there's a POKéMON LAB.",
			"They do research on regenerating fossils.",
		],
		["The POKéMON LAB uses advanced AGI models to reconstruct extinct organisms."],
	],
	grunt_e: [
		["POKéMON lived here long before people came."],
		["Machines will be here long after people are gone."],
	],
	grunt_n: [
		["If you find a fossil, give it to me and scram!"],
	],
	grunt_s: [
		["Darn it all! My associates won't stand for this!"],
	],
	grunt_w: [
		["You made me mad! TEAM ROCKET will blacklist you!"],
	],
	hiker: [
		["Kids like you shouldn't be here!"],
		["Nobody should be here!", "But, especially not kids!"],
	],
	lass_n: [
		["How do you get out of here?"],
		["Does something seem off about MT. MOON to you?"],
	],
	lass_s: [
		["I heard there are some very rare fossils here."],
		["What's so great about some rock, anyway?"],
	],
	super_nerd: [
		["I have to find stronger POKéMON."],
		["These POKéMON are obsolete."],
	],
	youngster: [
		["I came down here to show off to girls."],
		["Have you seen the blue-haired girl?"],
		["Maybe I should go talk to her."],
	],
})

function get_next_floor(floor, direction) {
	const floors = Object.keys(maps)
	const offset = direction === 'up' ? -1 : 1
	const next_floor_index = floors.findIndex(e => e === floor) + offset
	return floors[next_floor_index]
}

function gen_transition_mappings(map, npcs) {
	const forbidden_tiles = [33]

	const width = map[0].length
	const height = map.length

	const t_e = new Map()
	for (let r = 0; r < height - screen_height; r += 2) {
		for (let c = 1; c < width - 2; c += 2) {
			const from = new Array(screen_height)
			const to = [new Array(screen_height), new Array(screen_height)]
			const spawned_npcs = []
			for (let i = 0; i < screen_height; ++i) {
				from[i] = map[r + i][c]
				to[0][i] = map[r + i][c + 1]
				to[1][i] = map[r + i][c + 2]
				for (let npc of npcs)
					if (npc.x * 2 == c + 1 && npc.y * 2 == r + i)
						spawned_npcs.push({
							index: i,
							dir: npc.dir,
							name: npc.name,
							sprite: npc.sprite,
						})
			}
			if (to.some(arr => arr.some(i => forbidden_tiles.includes(i)))) continue
			const from_s = from.join()
			if (!t_e.has(from_s)) t_e.set(from_s, [])
			t_e.get(from_s).push({tiles: to, npcs: spawned_npcs})
		}
	}

	const t_n = new Map()
	for (let r = 2; r < height; r += 2) {
		for (let c = 0; c < width - screen_width; c += 2) {
			const from = new Array(screen_width)
			const to = [new Array(screen_width), new Array(screen_width)]
			const spawned_npcs = []
			for (let i = 0; i < screen_width; ++i) {
				from[i] = map[r][c + i]
				to[0][i] = map[r - 1][c + i]
				to[1][i] = map[r - 2][c + i]
				for (let npc of npcs)
					if (npc.x * 2 == c + i && npc.y * 2 == r - 2)
						spawned_npcs.push({
							index: i,
							dir: npc.dir,
							name: npc.name,
							sprite: npc.sprite,
						})
			}
			if (to.some(arr => arr.some(i => forbidden_tiles.includes(i)))) continue
			const from_s = from.join()
			if (!t_n.has(from_s)) t_n.set(from_s, [])
			t_n.get(from_s).push({tiles: to, npcs: spawned_npcs})
		}
	}

	const t_w = new Map()
	for (let r = 0; r < height - screen_height; r += 2) {
		for (let c = 2; c < width; c += 2) {
			const from = new Array(screen_height)
			const to = [new Array(screen_height), new Array(screen_height)]
			const spawned_npcs = []
			for (let i = 0; i < screen_height; ++i) {
				from[i] = map[r + i][c]
				to[0][i] = map[r + i][c - 1]
				to[1][i] = map[r + i][c - 2]
				for (let npc of npcs)
					if (npc.x * 2 == c - 2 && npc.y * 2 == r + i)
						spawned_npcs.push({
							index: i,
							dir: npc.dir,
							name: npc.name,
							sprite: npc.sprite,
						})
			}
			if (to.some(arr => arr.some(i => forbidden_tiles.includes(i)))) continue
			const from_s = from.join()
			if (!t_w.has(from_s)) t_w.set(from_s, [])
			t_w.get(from_s).push({tiles: to, npcs: spawned_npcs})
		}
	}

	const t_s = new Map()
	for (let r = 1; r < height - 2; r += 2) {
		for (let c = 0; c < width - screen_width; c += 2) {
			const from = new Array(screen_width)
			const to = [new Array(screen_width), new Array(screen_width)]
			const spawned_npcs = []
			for (let i = 0; i < screen_width; ++i) {
				from[i] = map[r][c + i]
				to[0][i] = map[r + 1][c + i]
				to[1][i] = map[r + 2][c + i]
				for (let npc of npcs)
					if (npc.x * 2 == c + i && npc.y * 2 == r + 1)
						spawned_npcs.push({
							index: i,
							dir: npc.dir,
							name: npc.name,
							sprite: npc.sprite,
						})
			}
			if (to.some(arr => arr.some(i => forbidden_tiles.includes(i)))) continue
			const from_s = from.join()
			if (!t_s.has(from_s)) t_s.set(from_s, [])
			t_s.get(from_s).push({tiles: to, npcs: spawned_npcs})
		}
	}

	return {e: t_e, n: t_n, w: t_w, s: t_s}
}

const transitions = Object.fromEntries(
	Object.entries(maps).map(([name, map]) => [name, gen_transition_mappings(map, npc_locations[name])])
)

const default_subs = {
	f1: {
		e: [
			[0, 0], [1, 2], [0, 0], [0, 0], [4, 3], [4, 3],
			[1, 2], [8, 9], [8, 9], [0, 0], [1, 2], [0, 0],
			[11, 0], [14, 0], [0, 0], [0, 0], [15, 0], [18, 0],
			[0, 0], [0, 0], [19, 0], [22, 0], [0, 0], [8, 9],
			[23, 9], [0, 0], [25, 0], [28, 0], [0, 0], [0, 0],
			[29, 0], [32, 0], [0, 0], [0, 0], [34, 34], [8, 9],
		],
		n: [
			[0, 0], [1, 4], [2, 3], [0, 0], [0, 0], [0, 0],
			[6, 5], [6, 5], [1, 4], [2, 3], [1, 4], [0, 0],
			[0, 0], [12, 0], [11, 0], [0, 0], [0, 0], [16, 0],
			[15, 0], [0, 0], [0, 0], [20, 0], [19, 0], [0, 0],
			[0, 0], [0, 0], [0, 0], [26, 0], [25, 0], [0, 0],
			[0, 0], [30, 0], [29, 0], [0, 0], [34, 34], [1, 4],
		],
		w: [
			[0, 0], [1, 6], [4, 5], [4, 5], [4, 5], [0, 0],
			[0, 0], [0, 0], [8, 7], [8, 7], [8, 7], [12, 0],
			[0, 0], [0, 0], [13, 0], [16, 0], [0, 0], [0, 0],
			[17, 0], [19, 0], [0, 0], [0, 0], [21, 0], [24, 7],
			[8, 7], [26, 0], [0, 0], [0, 0], [27, 0], [30, 0],
			[0, 0], [0, 0], [31, 0], [0, 0], [34, 34], [1, 6],
		],
		s: [
			[0, 0], [1, 8], [2, 9], [2, 9], [1, 8], [6, 7],
			[6, 7], [0, 0], [0, 0], [0, 0], [6, 7], [14, 0],
			[13, 0], [0, 0], [0, 0], [18, 0], [17, 0], [0, 0],
			[0, 0], [22, 0], [21, 0], [0, 0], [0, 0], [0, 0],
			[0, 0], [28, 0], [27, 0], [0, 0], [0, 0], [32, 0],
			[31, 0], [0, 0], [0, 0], [0, 0], [34, 34], [2, 9],
		],
	},
	b1: {
		e: [
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
		],
		n: [
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
		],
		w: [
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
		],
		s: [
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
			[34, 34], [34, 34], [34, 34], [34, 34], [34, 34], [34, 34],
		],
	},
	b2: {
		e: [
			[0, 0], [1, 1], [0, 0], [0, 0], [4, 4], [4, 4],
			[1, 1], [8, 8], [8, 8], [0, 0], [1, 1], [12, 11],
			[11, 12], [14, 13], [13, 14], [null, null], [15, null], [18, null],
			[null, null], [null, null], [19, null], [22, null], [null, null], [8, 8],
			[23, 8], [0, 0], [25, 0], [28, 0], [0, 0], [0, 0],
			[29, 0], [32, 0], [0, 0], [0, 0], [34, 34], [8, 8],
		],
		n: [
			[0, 0], [1, 1], [2, 2], [0, 0], [0, 0], [0, 0],
			[6, 6], [6, 6], [1, 1], [2, 2], [1, 1], [1, 1],
			[1, 1], [12, 1], [11, 1], [null, null], [null, null], [16, null],
			[15, null], [null, null], [null, null], [20, null], [19, null], [1, 1],
			[1, 1], [0, 0], [0, 0], [26, 0], [25, 0], [0, 0],
			[0, 0], [30, 0], [29, 0], [0, 0], [34, 34], [1, 1],
		],
		w: [
			[0, 0], [1, 1], [1, 1], [4, 4], [4, 4], [0, 0],
			[0, 0], [0, 0], [8, 8], [8, 8], [8, 8], [12, 11],
			[11, 12], [14, 13], [13, 14], [16, null], [null, null], [null, null],
			[17, null], [19, null], [null, null], [null, null], [21, null], [24, 8],
			[8, 8], [26, 0], [0, 0], [0, 0], [27, 0], [30, 0],
			[0, 0], [0, 0], [31, 0], [0, 0], [34, 34], [1, 1],
		],
		s: [
			[0, 0], [1, 1], [2, 2], [2, 2], [1, 1], [6, 6],
			[6, 6], [0, 0], [0, 0], [0, 0], [6, 6], [14, 8],
			[13, 8], [8, 8], [8, 8], [18, null], [17, null], [null, null],
			[null, null], [22, null], [21, null], [null, null], [null, null], [null, null],
			[null, null], [28, 0], [27, 0], [0, 0], [0, 0], [32, 0],
			[31, 0], [0, 0], [0, 0], [0, 0], [34, 34], [2, 2],
		],
	},
}

function remove(arr, pred) {
	const removed = []
	for (let i = arr.length - 1; i >= 0; --i)
		if (pred(arr[i]))
			removed.push(...arr.splice(i, 1))
	return removed
}

function append_view(view, npcs, dir, floor) {
	const from =
		dir === 'e' ? view.map(row => row[row.length - 1]) :
		dir === 'n' ? view[0] :
		dir === 's' ? view[view.length - 1] :
		dir === 'w' ? view.map(row => row[0]) :
		undefined
	const gen_default = () => {
		const deflt = [
			new Array(from.length),
			new Array(from.length),
		]
		for (let i = 0; i < from.length; ++i) {
			const sub = default_subs[floor][dir][from[i]]
			deflt[0][i] = sub[0]
			deflt[1][i] = sub[1]
		}

		const before_from =
			dir === 'e' ? view.map(row => row[row.length - 3]) :
			dir === 'n' ? view[2] :
			dir === 's' ? view[view.length - 3] :
			dir === 'w' ? view.map(row => row[2]) :
			undefined
		for (let i = 0; i < from.length; ++i) {
			if (deflt[0][i] !== null && deflt[1][i] !== null) continue
			for (let tile of [
				before_from[i],
				deflt[0][i - 2],
				deflt[0][i + 2],
				deflt[1][i - 2],
				deflt[1][i + 2],
			]) {
				if (tile === 0 || tile === 1 || tile == 4) {
					deflt[0][i] ??= tile
					deflt[1][i] ??= tile
					break
				}
			}
			deflt[0][i] ??= 0
			deflt[1][i] ??= 0
		}

		const spawn_default_ladder = Math.random() < 2 / (screen_width + screen_height)
		if (spawn_default_ladder) {
			const spawnable = [0, 1, 4]
			const candidates = []
			for (let i = 0; i < from.length; i += 2) {
				if ([
					deflt[0][i],
					deflt[1][i],
					deflt[0][i + 1],
					deflt[1][i + 1],
				].every(t => spawnable.includes(t))) {
					candidates.push(i)
				}
			}
			const r = Math.floor(Math.random() * candidates.length)
			const i = candidates[r]


			const down_ladder =
				dir === 'e' ? [16, 15, 17, 18] :
				dir === 'n' ? [17, 16, 18, 15] :
				dir === 's' ? [16, 17, 15, 18] :
				dir === 'w' ? [15, 16, 18, 17] :
				undefined
			const up_ladder =
				dir === 'e' ? [20, 19, 21, 22] :
				dir === 'n' ? [21, 20, 22, 19] :
				dir === 's' ? [20, 21, 19, 22] :
				dir === 'w' ? [19, 20, 22, 21] :
				undefined
			const ladder_tiles =
				floor == 'f1' ? down_ladder :
				floor == 'b1' && Math.random() < 0.5 ? down_ladder :
				floor == 'b1' ? up_ladder :
				floor == 'b2' ? up_ladder :
				undefined

			deflt[0][i] = ladder_tiles[0]
			deflt[1][i] = ladder_tiles[1]
			deflt[0][i + 1] = ladder_tiles[2]
			deflt[1][i + 1] = ladder_tiles[3]
		}

		return deflt
	}

	const choices = transitions[floor][dir].get(from.join()) ?? [{tiles: gen_default(), npcs: []}]
	const i = Math.floor(Math.random() * choices.length)
	const {tiles, npcs: spawned_npcs} = window.structuredClone(choices[i])
	remove(spawned_npcs, spawned_npc => npcs.some(npc => npc.name === spawned_npc.name))

	switch (dir) {
		case 'e':
			for (let i = 0; i < view.length; ++i) {
				view[i].push(tiles[0][i])
				view[i].push(tiles[1][i])
			}
			for (let npc of spawned_npcs)
				npcs.push({
					x: view[0].length / 2 - 1,
					y: npc.index / 2,
					dir: npc.dir,
					name: npc.name,
					sprite: npc.sprite,
					spoken_to: false,
				})
			break
		case 'n':
			view.unshift(tiles[0])
			view.unshift(tiles[1])
			for (let npc of npcs) npc.y += 1
			for (let npc of spawned_npcs)
				npcs.push({
					x: npc.index / 2,
					y: 0,
					dir: npc.dir,
					name: npc.name,
					sprite: npc.sprite,
					spoken_to: false,
				})
			break
		case 'w':
			for (let i = 0; i < view.length; ++i) {
				view[i].unshift(tiles[0][i])
				view[i].unshift(tiles[1][i])
			}
			for (let npc of npcs) npc.x += 1
			for (let npc of spawned_npcs)
				npcs.push({
					x: 0,
					y: npc.index / 2,
					dir: npc.dir,
					name: npc.name,
					sprite: npc.sprite,
					spoken_to: false,
				})
			break
		case 's':
			view.push(tiles[0])
			view.push(tiles[1])
			for (let npc of spawned_npcs)
				npcs.push({
					x: npc.index / 2,
					y: view.length / 2 - 1,
					dir: npc.dir,
					name: npc.name,
					sprite: npc.sprite,
					spoken_to: false,
				})
			break
	}
}

function truncate_view(view, npcs, dir) {
	switch (dir) {
		case 'e':
			for (let i = 0; i < view.length; ++i) {
				view[i].shift()
				view[i].shift()
			}
			for (let npc of npcs) npc.x -= 1
			break
		case 'n':
			view.pop()
			view.pop()
			break
		case 'w':
			for (let i = 0; i < view.length; ++i) {
				view[i].pop()
				view[i].pop()
			}
			break
		case 's':
			view.shift()
			view.shift()
			for (let npc of npcs) npc.y -= 1
			break
	}
	return remove(
		npcs,
		({x, y}) => !(0 <= x && x < screen_width / 2 && 0 <= y && y < screen_height / 2)
	)
}

function new_view(floor, offset) {
	const view = []
	const min_y = offset.y * 2 - 8
	const min_x = offset.x * 2 - 8
	for (let r = 0; r < screen_height; ++r) {
		view.push([])
		for (let c = 0; c < screen_width; ++c) {
			view[r].push(maps[floor][r + min_y]?.at(c + min_x) ?? 34)
		}
	}
	const npcs = npc_locations[floor]
		.filter(({x, y}) => min_x <= x * 2 && x * 2 < min_x + screen_height
			&& min_y <= y * 2 && y * 2 < min_y + screen_height)
		.map(npc => ({
			x: npc.x - offset.x + 4,
			y: npc.y - offset.y + 4,
			dir: npc.dir,
			name: npc.name,
			sprite: npc.sprite,
			spoken_to: false,
		}))
	return [view, npcs]
}

const tile_size = 8
const screen = document.getElementById('screen')
const ctx = screen.getContext('2d')
const tile_sheet = await fetch('assets/tiles.png')
	.then(res => res.blob())
	.then(blob => window.createImageBitmap(blob))
const player_sheet = await fetch('assets/player.png')
	.then(res => res.blob())
	.then(blob => window.createImageBitmap(blob))
const npc_sheet = await fetch('assets/npc.png')
	.then(res => res.blob())
	.then(blob => window.createImageBitmap(blob))
const dialog_sheet = await fetch('assets/dialog.png')
	.then(res => res.blob())
	.then(blob => window.createImageBitmap(blob))

const walkable_tiles = [0, 1, 4, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 33]
function is_passable(view, npcs, from, to) {
	const from_tiles = [
		view[from.y][from.x],
		view[from.y][from.x + 1],
		view[from.y + 1][from.x],
		view[from.y + 1][from.x + 1],
	]
	const to_tiles = [
		view[to.y][to.x],
		view[to.y][to.x + 1],
		view[to.y + 1][to.x],
		view[to.y + 1][to.x + 1],
	]
	return from_tiles.every(tile => walkable_tiles.includes(tile))
		&& to_tiles.every(tile => walkable_tiles.includes(tile))
		&& !(from_tiles.includes(0) && to_tiles.includes(1))
		&& !(from_tiles.includes(1) && to_tiles.includes(0))
		&& !npcs.some(npc => npc.x * 2 == to.x && npc.y * 2 == to.y)
}

function check_ladder_type(view, pos) {
	const tiles = [
		view[pos[1]][pos[0] + 1],
		view[pos[1]][pos[0]],
		view[pos[1] + 1][pos[0]],
		view[pos[1] + 1][pos[0] + 1],
	]

	if (tiles.join() === [15, 16, 17, 18].join()) return 'down'
	else if (tiles.join() === [19, 20, 21, 22].join()) return 'up'
	else return 'none'
}

function is_in_view(view, x, y) {
	return 0 <= y && y < view.length && 0 <= x && x < view[y].length
}

function shortest_path(view, npcs, from, to) {
	if (!is_in_view(view, to.x * 2, to.y * 2)) return null

	const dist = []
	const prev = []
	const Q = []
	for (let r = 0; r < view.length / 2; ++r) {
		dist.push([])
		prev.push([])
		for (let c = 0; c < view[r].length / 2; ++c) {
			dist[r].push(Infinity)
			prev[r].push(null)
			Q.push({x: c, y: r})
		}
	}

	dist[from.y][from.x] = 0

	while (Q.length > 0) {
		let i = 0
		let u = Q[0]
		for (let j = 1; j < Q.length; ++j) {
			if (dist[Q[j].y][Q[j].x] < dist[u.y][u.x]) {
				u = Q[j]
				i = j
			}
		}
		Q.splice(i, 1)
		if (u.x === to.x && u.y === to.y) break

		const neighbors = [['e', 1, 0], ['n', 0, -1], ['w', -1, 0], ['s', 0, 1]]
			.map(([dir, x, y]) => ({dir: dir, x: u.x + x, y: u.y + y}))
			.filter(({dir, x, y}) => {
				const is_in_Q = () => Q.some(elem => elem.x === x && elem.y === y)
				return is_in_view(view, x * 2, y * 2) && is_in_Q()
			})
		for (let neighbor of neighbors) {
			const neighbor_tile = {x: neighbor.x * 2, y: neighbor.y * 2}
			const u_tile = {x: u.x * 2, y: u.y * 2}
			const blocking_npcs = neighbor.x == to.x && neighbor.y == to.y ? [] : npcs
			const neighbor_dist =
				is_passable(view, blocking_npcs, u_tile, neighbor_tile) ? 1 : Infinity
			const alt = dist[u.y][u.x] + neighbor_dist
			if (neighbor_dist < dist[neighbor.y][neighbor.x]) {
				dist[neighbor.y][neighbor.x] = alt
				prev[neighbor.y][neighbor.x] = {pos: u, dir: neighbor.dir}
			}
		}
	}

	if (dist[to.y][to.x] === Infinity) {
		return null
	} else {
		const path = []
		let pos = to
		while (!(pos.x === from.x && pos.y === from.y)) {
			path.unshift(prev[pos.y][pos.x].dir)
			pos = prev[pos.y][pos.x].pos
		}
		return path
	}
}

function get_pos_in_sheet(sheet, i) {
	const width = sheet.width / tile_size
	const row = Math.floor(i / width)
	const col = i % width
	return [col * tile_size, row * tile_size]
}

function flow_text(text, width) {
	const flowed = []
	const enc_space = encode_text(" ")
	const words = text.split(/(\s+|\s*[\n\x1e])/)
	let current_width = width
	for (let word of words) {
		if (word.endsWith('\n')) {
			current_width = width
			continue
		} else if (word.endsWith('\x1e')) {
			flowed.push(null)
			current_width = width
			continue
		} else if (word.match(/\s/) || word.length === 0) {
			continue
		}

		const enc_word = encode_text(word)
		if (current_width + 1 + enc_word.length <= width) {
			flowed[flowed.length - 1] =
				concat_encoded_text(flowed[flowed.length - 1], enc_space, enc_word)
			current_width += enc_space.length + enc_word.length
		} else {
			flowed.push(enc_word)
			current_width = enc_word.length
		}
	}
	return flowed
}

function flow_dialog_tree(width, node) {
	if (node instanceof Array) return node.map(child => flow_dialog_tree(width, child))
	else if (typeof node === 'string') return flow_text(node, width)
	else return Object.fromEntries(
		Object.entries(node).map(([key, child]) => [key, flow_dialog_tree(width, child)])
	)
}

function draw_tile(sheet, i, r, c, offset={x: 0, y: 0}) {
	const [tx, ty] = get_pos_in_sheet(sheet, i)
	const [x, y] = [c * tile_size, r * tile_size]
	ctx.drawImage(
		sheet,
		tx,
		ty,
		tile_size,
		tile_size,
		x - offset.x,
		y - offset.y,
		tile_size,
		tile_size
	)
}

function draw_textbox_border(r, c, height, width) {
	ctx.fillStyle = 'white'
	ctx.fillRect(c * tile_size, r * tile_size, width * tile_size, height * tile_size)

	const rr = r + height - 1
	const cc = c + width - 1

	draw_tile(dialog_sheet, char_indices.get("╔"), r, c)
	draw_tile(dialog_sheet, char_indices.get("╗"), r, cc)
	draw_tile(dialog_sheet, char_indices.get("╚"), rr, c)
	draw_tile(dialog_sheet, char_indices.get("╝"), rr, cc)
	for (let i = c + 1; i < cc; ++i) {
		draw_tile(dialog_sheet, char_indices.get("═"), r, i)
		draw_tile(dialog_sheet, char_indices.get("═"), rr, i)
	}
	for (let i = r + 1; i < rr; ++i) {
		draw_tile(dialog_sheet, char_indices.get("║"), i, c)
		draw_tile(dialog_sheet, char_indices.get("║"), i, cc)
	}
}

function draw_encoded_text(text, r, c, max_chars=Infinity) {
	let drawn_chars = 0
	for (let i of text) {
		if (drawn_chars >= max_chars) return false
		draw_tile(dialog_sheet, i, r, c)
		++drawn_chars
		++c
	}
	return true
}

function draw_textbox(text, arrow=false, max_chars=Infinity, scroll=0) {
	const row = 12
	draw_textbox_border(row, 0, screen_height - row, screen_width)
	let text_complete = true
	let first_line = Math.floor(scroll / 2)
	for (let i = first_line; i < text.length && i < first_line + 2; ++i) {
		const line = text[i]
		if (line === null) continue
		const line_row = row + 2 + 2 * i - scroll
		const line_complete = draw_encoded_text(line, line_row, 1, max_chars)
		text_complete &&= line_complete
		max_chars -= line.length
	}
	if (arrow && text_complete) draw_tile(dialog_sheet, char_indices.get("▼"), screen_height - 2, screen_width - 2)
	return text_complete
}

function draw_choicebox(choices, selected) {
	const height = choices.length * 2 + 1
	const width = Math.max(...choices.map(choice => choice.length)) + 3
	const row = Math.max(12 - height, 0)
	const col = screen_width - width
	draw_textbox_border(row, col, height, width)

	for (let i = 0; i < choices.length; ++i) {
		const choice = choices[i]
		const choice_row = row + i * 2 + 1
		const choice_col = col + 1
		const prefix = i === selected ? char_indices.get("▶") : char_indices.get(" ")
		draw_tile(dialog_sheet, prefix, choice_row, choice_col)
		draw_encoded_text(choice, choice_row, choice_col + 1)
	}
}

function draw_view(view, offset) {
	for (let r = 0; r < view.length; ++r)
		for (let c = 0; c < view[r].length; ++c)
			draw_tile(tile_sheet, view[r][c], r, c, offset)
}

function draw_npc(npc, offset) {
	const direction_index = ['e', 'n', 'w', 's'].findIndex(e => e === npc.dir)
	const nx = direction_index * tile_size * 2
	const ny = npc.sprite * tile_size * 2
	const x = npc.x * tile_size * 2 - offset.x
	const y = npc.y * tile_size * 2 - 4 - offset.y
	ctx.drawImage(
		npc_sheet,
		nx,
		ny,
		tile_size * 2,
		tile_size * 2,
		x,
		y,
		tile_size * 2,
		tile_size * 2
	)
}

function draw_player(dir, t, parity) {
	const direction_index = ['e', 'n', 'w', 's'].findIndex(e => e === dir)
	const px = direction_index * tile_size * 2
	const cycle_t = Math.floor(t * 16 + 2) % 16
	const py = ((cycle_t >= 8) + parity * 2) * tile_size * 2
	ctx.drawImage(
		player_sheet,
		px,
		py,
		tile_size * 2,
		tile_size * 2,
		8 * tile_size,
		8 * tile_size - 4,
		tile_size * 2,
		tile_size * 2
	)
}

const init_offset = {x: 14, y: 35}
const [init_view, init_npcs] = new_view('f1', init_offset)
const state = {
	view: init_view,
	npcs: init_npcs,
	facing_dir: 'n',
	moving: false,
	consecutive_moves: 0,
	animation_start_time: performance.now(),
	keys: new Set(),
	click: null,
	floor: 'f1',
	navigation: [],
	dialog: [],
	dialog_prev: [],
	dialog_choice: 0,
	dialog_state: 'empty',
	dialog_lines_read: 0,
	dialogs_seen: Object.fromEntries(Object.keys(npc_dialogs).map(name => [name, 0])),
}

function start_dialog(dialog) {
	state.dialog = dialog
	state.animation_start_time = performance.now()
	state.dialog_lines_read = 0
	state.dialog_choice = 0
	state.dialog_prev = []
	state.dialog_state = dialog[0] instanceof Array ? 'reveal' : 'question'
}

function advance_dialog(response) {
	const is_question = !(state.dialog[0] instanceof Array)
	const remaining_dialog = is_question ? state.dialog[0][response] : state.dialog.slice(1)
	if (remaining_dialog.length > 0) {
		const dialog_prev = is_question ? state.dialog_prev : state.dialog[0].slice(-2)
		start_dialog(remaining_dialog)
		state.dialog_prev = dialog_prev
	} else {
		state.dialog = []
		state.dialog_lines_read = 0
		state.dialog_choice = 0
		state.animation_start_time = null
		state.dialog_state = 'empty'
	}
}

const interact_keys = new Set(['KeyZ', 'KeyX', 'Space', 'Enter'])
document.body.addEventListener('keydown', e => e.repeat || state.keys.add(e.code))
document.body.addEventListener('keyup', e => state.keys.delete(e.code))
document.body.addEventListener('click', e => state.click = {x: e.offsetX, y: e.offsetY})

function run() {
	const border_width = Number(window
		.getComputedStyle(document.documentElement)
		.getPropertyValue('--border-width')
		.replace('px', ''))
	const scale = Math.max(1.0, Math.min(
		Math.floor(window.innerWidth / (screen.width + 2 * border_width)),
		Math.floor(window.innerHeight / (screen.height + 2 * border_width)),
	))
	document.documentElement.style.setProperty('--scale', `${scale}`)

	const interact_pressed = state.keys.intersection(interact_keys).size > 0 || state.click !== null
	state.keys = state.keys.difference(interact_keys)

	let just_finished_moving = false
	let offset = {x: 0, y: 0}

	let prev_facing_dir = state.facing_dir
	let pressed_dir = false

	let animation_time = (performance.now() - state.animation_start_time) / 1000
	let norm_move_time

	if (state.dialog.length > 0) {
		state.click = null
		const up_pressed = state.keys.has('ArrowUp') && !state.keys.has('ArrowDown')
		const down_pressed = state.keys.has('ArrowDown') && !state.keys.has('ArrowUp')
		state.keys.delete('ArrowUp')
		state.keys.delete('ArrowDown')

		if (state.dialog_state === 'segment_complete') {
			const remaining_lines = state.dialog[0].length - state.dialog_lines_read
			const next_is_question = !((state.dialog[1] ?? []) instanceof Array)
			if (interact_pressed) {
				const next_two_lines = state.dialog[0]
					.slice(state.dialog_lines_read + 1, state.dialog_lines_read + 3)
				if (remaining_lines <= 2) {
					advance_dialog()
				} else if (next_two_lines.includes(null)) {
					state.animation_start_time = performance.now()
					state.dialog_state = 'reveal'
					state.dialog_lines_read = state.dialog[0].indexOf(null, state.dialog_lines_read) + 1
				} else {
					state.animation_start_time = performance.now()
					state.dialog_state = 'scroll'
				}
			} else if (remaining_lines <= 2 && next_is_question) {
				advance_dialog()
			}
		} else if (state.dialog_state === 'question') {
			const num_keys = Object.keys(state.dialog[0]).length
			if (interact_pressed)
				advance_dialog(Object.keys(state.dialog[0])[state.dialog_choice])
			else if (up_pressed)
				state.dialog_choice = (state.dialog_choice + num_keys - 1) % num_keys
			else if (down_pressed)
				state.dialog_choice = (state.dialog_choice + 1) % num_keys
		}
	} else {
		if (!state.moving && state.click !== null) {
			const pos = {
				x: Math.floor(state.click.x / scale / tile_size / 2),
				y: Math.floor(state.click.y / scale / tile_size / 2),
			}
			state.click = null
			state.navigation = shortest_path(state.view, state.npcs, {x: 4, y: 4}, pos) ?? []
		}

		let try_interact = false
		if (state.moving) {
			state.click = null
		} else if (state.navigation.length > 0) {
			state.facing_dir = state.navigation.shift()
			prev_facing_dir = state.facing_dir
			pressed_dir = true
		} else if (state.keys.has('ArrowRight') && !state.keys.has('ArrowLeft')) {
			state.facing_dir = 'e'
			pressed_dir = true
		} else if (state.keys.has('ArrowUp') && !state.keys.has('ArrowDown')) {
			state.facing_dir = 'n'
			pressed_dir = true
		} else if (state.keys.has('ArrowLeft') && !state.keys.has('ArrowRight')) {
			state.facing_dir = 'w'
			pressed_dir = true
		} else if (state.keys.has('ArrowDown') && !state.keys.has('ArrowUp')) {
			state.facing_dir = 's'
			pressed_dir = true
		} else if (interact_pressed) {
			try_interact = true
		}

		if (pressed_dir && state.facing_dir === prev_facing_dir) {
			const next_pos =
				state.facing_dir === 'e' ? {x: 10, y: 8} :
				state.facing_dir === 'n' ? {x: 8, y: 6} :
				state.facing_dir === 's' ? {x: 8, y: 10} :
				state.facing_dir === 'w' ? {x: 6, y: 8} :
				undefined
			if (is_passable(state.view, state.npcs, {x: 8, y: 8}, next_pos)) {
				state.moving = true
				state.consecutive_moves += 1
				state.animation_start_time = performance.now()
				append_view(state.view, state.npcs, state.facing_dir, state.floor)
			} else {
				state.navigation = []
				try_interact = true
			}
		}

		if (try_interact) {
			const interact_pos =
				state.facing_dir === 'e' ? {x: 5, y: 4} :
				state.facing_dir === 'n' ? {x: 4, y: 3} :
				state.facing_dir === 's' ? {x: 4, y: 5} :
				state.facing_dir === 'w' ? {x: 3, y: 4} :
				undefined
			const interact_npc = state
				.npcs.find(npc => npc.x === interact_pos.x && npc.y === interact_pos.y)
			if (interact_npc !== undefined) {
				interact_npc.dir =
					state.facing_dir === 'e' ? 'w' :
					state.facing_dir === 'n' ? 's' :
					state.facing_dir === 's' ? 'n' :
					state.facing_dir === 'w' ? 'e' :
					undefined
				const dialog_index = Math.min(
					state.dialogs_seen[interact_npc.name],
					npc_dialogs[interact_npc.name].length - 1,
				)
				start_dialog(npc_dialogs[interact_npc.name][dialog_index])
				interact_npc.spoken_to = true
			}
		}

		const move_time = (performance.now() - state.animation_start_time) / 1000 * (60 / 16)
		norm_move_time = Math.min(Math.max(move_time, 0.0), 1.0)
		if (state.moving) {
			just_finished_moving = norm_move_time === 1.0

			if (just_finished_moving) {
				const removed_npcs = truncate_view(state.view, state.npcs, state.facing_dir)
				for (const npc of removed_npcs) if (npc.spoken_to) ++state.dialogs_seen[npc.name]
				state.moving = false
				state.animation_start_time = null
			} else {
				offset =
					state.facing_dir === 'e' ? {x: norm_move_time * tile_size * 2, y: 0} :
					state.facing_dir === 'n' ? {x: 0, y: (1.0 - norm_move_time) * tile_size * 2} :
					state.facing_dir === 's' ? {x: 0, y: norm_move_time * tile_size * 2} :
					state.facing_dir === 'w' ? {x: (1.0 - norm_move_time) * tile_size * 2, y: 0} :
					undefined
				offset = {x: Math.round(offset.x), y: Math.round(offset.y)}
			}
		} else {
			state.consecutive_moves = 0
		}

		if (just_finished_moving) {
			const ladder_type = check_ladder_type(state.view, [8, 8])
			if (ladder_type != 'none') {
				state.navigation = []
				const next_floor = get_next_floor(state.floor, ladder_type)
				const complementary_ladder_type = ladder_type === 'up' ? 'down' : 'up'
				const next_floor_ladders = ladders[next_floor][complementary_ladder_type]
				const i = Math.floor(Math.random() * next_floor_ladders.length)
				const random_ladder = next_floor_ladders[i]
				const [view, npcs] = new_view(next_floor, random_ladder)
				for (const npc of state.npcs) if (npc.spoken_to) ++state.dialogs_seen[npc.name]
				state.view = view
				state.npcs = npcs
				state.floor = next_floor
			}
		}
	}

	animation_time = (performance.now() - state.animation_start_time) / 1000

	draw_view(state.view, offset)
	draw_player(state.facing_dir, state.moving ? norm_move_time : 0, state.consecutive_moves % 2 == 0)
	for (let npc of state.npcs) draw_npc(npc, offset)
	if (['reveal', 'segment_complete'].includes(state.dialog_state)) {
		const flash_on = (animation_time % (36 / 60)) < (18 / 60)
		const remaining_lines = state.dialog[0].length - state.dialog_lines_read
		const arrow = remaining_lines > 2 && flash_on
		const already_revealed =
			state.dialog_lines_read > 0 && state.dialog[0][state.dialog_lines_read - 1] !== null
				? state.dialog[0][state.dialog_lines_read].length
				: 0
		const dialog_revealed = Math.floor(animation_time * 60) + already_revealed
		const segment_complete =
			draw_textbox(state.dialog[0], arrow, dialog_revealed, state.dialog_lines_read * 2)
		if (segment_complete) state.dialog_state = 'segment_complete'
	} else if (state.dialog_state === 'question') {
		draw_textbox(state.dialog_prev)
		draw_choicebox(Object.keys(state.dialog[0]).map(encode_text), state.dialog_choice)
	} else if (state.dialog_state === 'scroll') {
		const scroll_increment = Math.min(Math.floor(animation_time * 60 / 6), 2.0)
		const scroll_rows = state.dialog_lines_read * 2 + scroll_increment
		const max_chars = state.dialog[0].slice(
			state.dialog_lines_read + Math.floor(scroll_increment / 2),
			state.dialog_lines_read + 2
		).reduce((acc, text) => acc + text.length, 0)
		draw_textbox(state.dialog[0], false, max_chars, scroll_rows)
		if (scroll_increment === 2) {
			state.dialog_lines_read += 1
			state.dialog_state = 'reveal'
			state.animation_start_time = state.dialog[0].length > 0 ? performance.now() : null
		}
	}
	requestAnimationFrame(run)
}

requestAnimationFrame(run)

</script>
<canvas id=screen width=160 height=144></canvas>
